<!DOCTYPE html>
<meta charset="utf-8">
<style>
  body {
    font-family: Arial, sans-serif;
  }
  svg {
    border: 1px solid lightgray;
  }
  .node rect {
    fill: #fff;
    stroke: steelblue;
    stroke-width: 1.5px;
  }
  .node image {
    cursor: pointer;
  }
  .node text {
    font-size: 12px;
  }
  .tooltip {
    position: absolute;
    text-align: left;
    width: 180px;
    padding: 8px;
    font: 12px sans-serif;
    background: lightyellow;
    border: 1px solid gray;
    pointer-events: none;
    border-radius: 4px;
  }
</style>
<body>
<div id="tooltip" class="tooltip" style="opacity:0;"></div>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  const data = {
    name: "Иван Иванов",
    born: "1900",
    died: "1970",
    desc: "Основатель семьи",
    img: "https://via.placeholder.com/50",
    children: [
      {
        name: "Петр Иванов",
        born: "1925",
        died: "1990",
        desc: "Старший сын",
        img: "https://via.placeholder.com/50",
        children: [
          {
            name: "Ольга Петрова",
            born: "1950",
            died: "",
            desc: "Дочь Петра",
            img: "https://via.placeholder.com/50"
          }
        ]
      },
      {
        name: "Анна Иванова",
        born: "1930",
        died: "2000",
        desc: "Младшая дочь",
        img: "https://via.placeholder.com/50"
      }
    ]
  };

  const width = 960;
  const height = 600;

  const svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height)
      .call(d3.zoom().scaleExtent([0.5, 3]).on("zoom", (event) => {
        g.attr("transform", event.transform);
      }));

  const g = svg.append("g").attr("transform", "translate(40,40)");

  const tree = d3.tree().size([height - 100, width - 160]);

  const root = d3.hierarchy(data);

  tree(root);

  // links
  g.selectAll(".link")
    .data(root.links())
    .enter().append("path")
    .attr("class", "link")
    .attr("fill", "none")
    .attr("stroke", "#ccc")
    .attr("stroke-width", 2)
    .attr("d", d3.linkHorizontal()
        .x(d => d.y)
        .y(d => d.x));

  // nodes
  const node = g.selectAll(".node")
    .data(root.descendants())
    .enter().append("g")
    .attr("class", "node")
    .attr("transform", d => `translate(${d.y},${d.x})`);

  node.append("rect")
    .attr("x", -55)
    .attr("y", -30)
    .attr("width", 110)
    .attr("height", 60)
    .attr("rx", 10)
    .attr("ry", 10)
    .attr("fill", "#f0f8ff")
    .attr("stroke", "steelblue");

  node.append("image")
    .attr("xlink:href", d => d.data.img)
    .attr("x", -50)
    .attr("y", -25)
    .attr("width", 50)
    .attr("height", 50);

  node.append("text")
    .attr("x", 10)
    .attr("y", -5)
    .text(d => d.data.name)
    .style("font-weight", "bold");

  node.append("text")
    .attr("x", 10)
    .attr("y", 15)
    .text(d => `${d.data.born} - ${d.data.died || ""}`);

  // Tooltip с описанием
  const tooltip = d3.select("#tooltip");

  node.on("mouseover", (event, d) => {
    tooltip.transition().duration(200).style("opacity", .9);
    tooltip.html(`<strong>Описание:</strong><br>${d.data.desc || "Нет описания"}`)
      .style("left", (event.pageX + 10) + "px")
      .style("top", (event.pageY - 28) + "px");
  }).on("mouseout", () => {
    tooltip.transition().duration(500).style("opacity", 0);
  });

</script>
</body>
</html>
